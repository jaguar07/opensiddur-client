<div>
    <div class="toolbar navbar navbar-inverse nav-collapse">
        <div class="container-fluid">
          <p class="navbar-text">{{ OutlinesService.content.outline.title.__text | truncate:30 }}</p>
          <div class="btn-toolbar navbar-btn">
              <div class="btn-group navbar-btn">
                  <button class="btn btn-primary" 
                      data-ng-disabled="!AuthenticationService.loggedIn"
                      data-ng-click="DialogService.open('newDialog')"
                      >New</button>
                  <button class="btn btn-primary" 
                      data-ng-click="DialogService.open('openDialog')"
                      >Open</button>
                  <button
                      class="btn btn-primary"
                      data-ng-class="{'btn-success' : outlineForm.$pristine}" type="submit" 
                      data-ng-click="editor.saveDocument()"  
                      data-ng-disabled="outlineForm.$invalid || outlineForm.$pristine">{{saveButtonText()}}</button>
                  <button
                      class="btn btn-primary"
                      data-ng-class="{'btn-success' : outlineForm.$pristine && editor.saved}" type="submit" 
                      data-ng-click="editor.execute()"  
                      data-ng-disabled="outlineForm.$invalid || outlineForm.$dirty">Execute</button>
              </div>
              <div class="btn-group navbar-btn">
                  <button class="btn btn-primary" 
                      data-ng-disabled="!editor.viewer.source" 
                      data-ng-show="!editor.viewer.active"
                      data-ng-click="editor.viewer.active = !editor.viewer.active">&#x25c0;Transcription</button>
                  <button class="btn btn-primary" 
                      data-ng-disabled="!editor.viewer.source" 
                      data-ng-show="editor.viewer.active"
                      data-ng-click="editor.viewer.active = !editor.viewer.active">Transcription&#x25b6;</button>
              </div>

          </div>
        </div>
    </div>
    
    <div class="page-container container-fluid sources-editor" data-ng-show="OutlinesService.content.outline.title.__text">
        <div class="row">
          <div ng-class="{true: 'col-md-6', false: 'col-md-12'}[editor.viewer.active]">
            <form name="outlineForm" class="form-horizontal">
                <h2>About the book</h2>
                <div class="form-group">
                    <label class="col-md-2" for="_title">Book title:</label>
                    <div class="col-md-8">
                      <input
                          placeholder="Book title"
                          class="form-control"
                          name="_title"
                          ng-model="OutlinesService.content.outline.title.__text" 
                          required="true"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2" for="_license">Text will be licensed under:</label>
                    <div class="col-md-3">
                        <select
                                class="form-control"
                                name="_license"
                                ng-model="OutlinesService.content.outline.license.__text"
                                required="true"
                                ng-options="uri as lic for (uri, lic) in LicensesService.supportedLicenses"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2" for="_lang">Primary language:</label>
                    <div class="col-md-3">
                      <select 
                          class="form-control"
                          name="_lang"
                          ng-model="OutlinesService.content.outline.lang.__text" 
                          required="true"
                          ng-options="code as language.toString() for (code, language) in LanguageService.supportedLanguages"/>
                    </div>
                </div>
                <!-- TODO: warnings and errors about the book go here -->
                <h2>Included items</h2>
                <div ng-repeat="item in OutlinesService.content.outline.item_asArray">
                  <div class="outline-item">
                    <div class="row">
                      <div class="col-md-1">
                        <span ng-repeat="l in outline.levelOf(item) track by $index">|</span>
                      </div>
                      <div class="col-md-2">
                        <button class="btn btn-xs" 
                          ng-click="outline.levelDown(item)"
                          ng-disabled="!outline.canLevelDown(item)">&lt;</button>
                        <button class="btn btn-xs btn-danger" 
                          ng-click="outline.remove(item)" 
                          ng-disabled="!outline.canRemove(item)">X</button>
                        <button class="btn btn-xs" 
                          ng-click="outline.addAfter(item, -1)" 
                          ng-disabled="!outline.canLevelDown(item)">|+</button>
                        <button class="btn btn-xs"
                          ng-click="!outline.addAfter(item, 0)">+</button>
                        <button class="btn btn-xs"
                          ng-click="!outline.addAfter(item, 1)">+|</button>
                        <button class="btn btn-xs" 
                          ng-click="outline.levelUp(item)"
                          ng-disabled="!outline.canLevelUp(item)">&gt;</button>
                      </div>
                      <div class="col-md-2">
                        <input ng-model="item.title.__text"/>
                      </div>
                      <div class="col-md-2">
                        <input ng-model="item.from.__text"/>
                      </div>
                      <div class="col-md-2">
                        <input ng-model="item.to.__text"/>
                      </div>
                      <div class="col-md-1">
                        <a class="btn btn-xs"
                          target="_blank"
                          ng-href="outline.edit(item)"
                          ng-disabled="!outline.canEdit(item)">Edit<span ng-show="item.status.__text">({{item.status.__text}})</span></a>
                      </div>
                    </div>
                    <!-- sameAs and acknowledgements -->
                    <div class="row" ng-repeat="sameAs in item.sameAs_asArray">
                      <!-- TODO: different alerts for no acknowledgement, ack yes, and ack no -->
                      <div ng-class="col-md-6 alert">Same title as another document: {{ sameAs.uri.__text }}</div>
                      <button class="btn btn-sm" ng-click="outline.viewSameAs(sameAs)">View it</button>
                      <!-- TODO: we need to set the value of the radio button to begin with -->
                      <div class="col-md-2">
                        <label class="radio-inline">
                          <input type="radio" name="sameAs_yes" ng-click="outline.setSameAs(sameAs, 'yes')"/>Yes
                        </label>
                        <label class="radio-inline">
                          <input type="radio" name="sameAs_no" ng-click="outline.setSameAs(sameAs, 'no')"/>No
                        </label>
                      </div>
                    </div>
                    <!-- errors and warnings -->
                    <div class="row" ng-repeat="err in item.error_asArray">
                      <div class="col-md-6 alert alert-danger">{{err.__text}}</div>
                    </div>
                    <div class="row" ng-repeat="wrn in item.warning_asArray">
                      <div class="col-md-6 alert alert-warning">{{wrn.__text}}</div>
                    </div>
                  </div>
                                      
                  <hr/>
                </div>
            </form>
          </div>
          <div ng-show="editor.viewer.active" ng-class="{true:'col-md-6', false:'off'}[editor.viewer.active]">
            <div class="row">
              <os-transcription-viewer source="editor.viewer.source" page="editor.viewer.page"
                name="outlines-transcription-window" height="512px">
              </os-transcription-viewer>
            </div>
          </div>

        </div>
    </div>
    <os-new-dialog 
            resource-type="'outline'" 
            model="editor.newTemplate"
            title="" 
            name="newDialog"
            on-ok="editor.newDocument"
            on-close="editor.dialogCancel"></os-new-dialog>
    <os-open-dialog api="'/api/data/outlines'"
        title="Open Outline" name="openDialog"
        on-ok="editor.openDocument" on-close="editor.dialogCancel"></os-open-dialog>
</div>
